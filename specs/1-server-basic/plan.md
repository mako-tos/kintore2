# 実装計画: サーバ基本機能

**ブランチ**: `1-server-basic` | **作成日**: 2025-11-02 | **仕様書**: spec.md

## 概要

この計画は `specs/1-server-basic/spec.md` の要件を満たすための実装上の詳細を示します。技術的な選択、デプロイ手順、シークレット管理、パフォーマンス検証などの運用ルールをここに記載します。

## 技術的コンテキスト

**言語/バージョン**: Node.js 22+, TypeScript
**主要依存関係**: Next.js, Pure.css
**ストレージ**: Supabase（Postgres互換）
**テスト**: ユニット/統合/エンドツーエンド（テストカバレッジ80%を目標）
**対象プラットフォーム**: Netlify（プレビュー + 本番デプロイ）
**プロジェクトタイプ**: Webアプリケーション
**パフォーマンス目標**: API応答時間500ms以内, FCP 500ms以内
**制約**:
 - フォント: 游明朝、游ゴシックを使用
 - 言語: 日本語対応を前提
 - シークレット管理: 環境変数（Netlifyの環境変数）で管理

## デプロイメントフロー

1. ブランチを作成して実装を進める
2. 必要なテストを追加し、CIで実行
3. PRを作成し、レビューと自動テストをパスしたらNetlifyのプレビューにデプロイ
4. ステージングで統合テストを実行
5. ステージング合格後に main へマージし、本番へデプロイ

**障害時の扱い**: 3回連続でテストが失敗した場合は `research.md` に問題点を記載しレビューで対応を決定する

## シークレットと環境管理

- すべてのシークレットは環境変数で管理し、コードにハードコードしない
- シークレットのローテーションポリシーをドキュメント化する
- Netlifyの環境変数およびアクセス権を適切に管理

## パフォーマンス計測と監視

- RUM(Real User Monitoring)を導入してFCP等を計測
- CIで簡易パフォーマンステストを実行（ベンチマーク）
- 障害発生時のログ集約: ログは外部のログサービスへ送信（例: Logflare/Supabase Logs等）

## バックアップと復元

- Supabaseのスナップショット/バックアップ手順を定期的に実行
- 復元手順をドキュメント化してリハーサルを行う

## セキュリティとコンプライアンス

- データは転送時/保存時に暗号化
- 最低限のアクセス権原則（最小権限）を適用
- 脆弱性スキャン（Dependabot等）を導入

## マイグレーション方針

- スキーマ変更は `data-model.md` の更新 + マイグレーションスクリプトをPRに含める
- 互換性を保つためにローリングアップデートや後方互換レイヤを検討

## テスト計画

- ユニットテスト: ロジックの単体検証
- 統合テスト: DBや外部サービスとの結合検証
- E2E: ユーザージャーニーをブラウザベースで検証

---

この計画は `spec.md` の要件を実装するための実務的なガイドラインを示します。変更がある場合は `spec.md` と `plan.md` の両方を更新してください。
